#!/usr/bin/env ruby

$:.unshift File.expand_path(File.dirname(__FILE__) + "/../lib")

require "bundler/setup"
require "core/util.rb"
require "core/log.rb"

Log::get "mud", { :default => true, :level => Logger::DEBUG }
Log::info RUBY_VERSION, "ruby version"

require "connections/base.rb"

TICK_DURATION = 5.0 # in seconds

while true
  tick_start = Time.now
  Connections::tick
  tick_duration = Time.now - tick_start
  Log::info "tick done, duration #{"%4.6f" % tick_duration}s, #{"%4.6f" % (tick_duration / TICK_DURATION * 100)}% capacity", "mud"
  sleep [0,TICK_DURATION - tick_duration].max
end
